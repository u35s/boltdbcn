<!DOCTYPE html>
<html lang="zh-CN">
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?9fbe6127772dc8dd4c04ce3d43d4d84a";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
  <meta name="keywords" content="boltdb实现机制分析" />
  <meta name="description" content="boltdb中文网">
  <meta name="author" content="u35s">
  <!--<link rel="icon" href="./favicon.ico">-->

  <title>boltdb实现机制分析</title>

  <!-- Bootstrap core CSS -->
  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <link href="./public/ie10-viewport-bug-workaround.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="./public/jumbotron.css" rel="stylesheet">

  <script src="./public/ie-emulation-modes-warning.js"></script>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <nav class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false"
          aria-controls="navbar">
          <span class="sr-only">导航</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">BoltDB中文网</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right hidden-sm">
          <li> 
            <a href="/runtime.html">实现分析</a>
          </li>
          <li>
            <a href="https://github.com/u35s/bolt">中文翻译</a>
          </li>
          <li class="active">
            <a href="/about.html">关于</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="content">
    <div class="container">
        <h3>BoltDB实现机制分析</h3>

		<h4>Bolt</h4>
		<p>Bolt是根据Howard Chu的LMDB项目开发的一个存粹的go语言版的key/value存储.
		它的目标是为项目提供一个简单、高效、可靠的嵌入式数据库而不是要求一个完成的数据库服务器，例如Postgres和MySQL.
		用作者的话说,Bolt只提供简单key/value存储,没有其他的特性,以后也不会有,加上Bolt原本的代码精简,质量高,很适合作为对数据库工作原理的感兴趣的同学的第一选择</p>

		<h4>Bolt的实现</h4>
		<ul>
				<li>Bolt使用操作体统提供的mmap技术避免I/O操作,使文件读取效率提高。</li>
				<li>使用单写多读,写时复制实现无锁MVCC</li>
				<li>内部使用B+树实现高性能随机读</li>
		</ul>
		
		<h4>主要的数据结构</h4>	
		<p>Bolt的主要数据结构有DB,Bucket,Tx,Cursor,node,inode,page</p>
		<p>DB表示数据库中的Bucket集合,Bucket表示数据库中的键值对集合,好比DB是Mysql,Bucket是Mysql中的一张表,键值对对应Mysql表中的一行数据. Cursor表示一个迭代器,该迭代器可以按顺序遍历bucket中的所有键/值对. Tx表示数据库中的一个只读或读写事务,只读事务可以用来创建Cursor,检索数据,读写事务还可以创建,删除Bucket和键. node表示一个在内存中的反序列化的page,inode是一个node中的内部节点,可以用来指向page中的元素或者还未被被添加到page中的元素。通常说的键值对就对应一个inode.</p>

		<h4>存储过程</h4>
		<p>不管是添加,删除还是读取,都需要先打开数据库,并获取一个事务,读事务中不允许进行任更改,只能检索bucket、检索值. 在读写事务结束时如果没有错误则提交事务,对应数据被更改,否则事务期间的所有的更改都被丢弃.不管是读取，删除还是写入,都需要通过Cursor来找到对应键的位置信息.如果是读取,比较对应位置的键和目标键是否相等,相等则找到并且返回,不相等则不存在返回nil.如果是删除,也比较对应位置的键和目标键是否相等,相等则删除对应数据.添加的话则在对应的位置插入对应值.</p>
		<p>其中查找特定键的实现是用B+树。在提交事务时,如果有删除操作则检查是否需要重新平衡,如果有数据更改则写入到Dirty Page,写入时检测是否有node需要拆分.其中着重说明的是有数据更新的话并且数据长度不一致,很可能导致数据所在Page的改变(默认情况下Bolt的Page在使用%50时就会切页,大数据块也可能占据连续的几页达到100%),这一块的代码很值得一读,会使你对B+树的使用,还有数据的实际存储有更深刻的理解,也会对平常说的分表提升性能(减少了更改数据时整个数据的移动)有更进一步的认识</p>


    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-sm-5 col-lg-5">
          <a class="social-icon" href="https://github.com/boltdb/bolt" target="_blank">
            <svg aria-labelledby="simpleicons-github-icon" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <title id="simpleicons-github-icon" lang="en">GitHub icon</title>
              <path fill="#FFFFFF" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
            </svg>
          </a>
          <a class="social-icon" href="https://jq.qq.com/?_wv=1027&k=5whK4gE" target="_blank">
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000"
              enable-background="new 0 0 1000 1000" xml:space="preserve">
              <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>
              <g>
                <path fill="#FFFFFF" d="M524.9,2.4c332.9,0,352.4,320.7,352.4,320.7c50.9,67.5,23.4,128,23.4,128c163.8,257.4,57.8,331.8,28.9,337.3c-28.9,5.5-56.5-31.7-56.5-31.7s-9.6,37.1-33,56.5c85.4,39.9,70.2,89.5,70.2,89.5s-17.9,149.7-373,55.1l-30.3-5.5c-340.4,122.9-382.7-42.7-382.7-42.7s-13.8-68.8,52.3-95c-38.6-23.4-52.3-72.9-52.3-72.9S89.8,798,44.4,777.4C-1,756.8-28.5,573.7,142.2,441.5c0,0-24.8-78.5,31.7-125.3C173.8,316.3,189,2.4,524.9,2.4 M245,334.2c-74.3,63.3-22.6,127.8-22.6,127.8C58.7,562.4,68.7,703.7,68.7,703.7s27.2-3.1,45.8-40.9c18.6-37.8,51.9,8.4,51.9,8.4s26.8,92.3,81.6,126.3c54.8,34-1.3,57.9-1.3,57.9s-59.2,0.9-54,41.8c5.2,41,175.4,73.4,292.2-17.5l67.5,10.5c203.8,70.9,285.3,22.5,292,9.9c6.7-12.7-30.8-37.6-65.2-52c-34.5-14.4-38.9-34.1-8.4-54.4c30.5-20.3,43.6-61.7,61.5-103.4c17.8-41.7,50.3-26.9,53.7-15.2c3.4,11.7,33.4,42,33.4,42s47.5-51.4-90.5-259.2c0,0,28.8-62.2-21.8-112.9c0,0,2.3-280.2-287.8-280.7C228.4,63.9,245,334.2,245,334.2"/>
              </g>
            </svg>
          </a>

          <p>遵循
            <a href="https://opensource.org/licenses/MIT" target="_blank">MIT 开源协议</a>
            <br>Copyright © 2018 u35s</p>

        </div>
        <div class="col-sm-7 col-lg-7 right">
          <div class="row">
            <div class="col-sm-3">
                <p>关于</p>
                <ul class="list-unstyled">
                  <li><a href="#" target="_blank">关于我们</a></li>
                  <li><a href="#" target="_blank">友情链接</a></li>
                </ul>
            </div>
            <div class="col-sm-3">
                <p>联系方式</p>
                <ul class="list-unstyled">
                  <li><a href="mailto:admin@boltdb.cn">电子邮件</a></li>
                  <li><a href="https://jq.qq.com/?_wv=1027&k=5whK4gE" target="_blank">QQ群:687423439</a></li>
                </ul>
            </div>
            <div class="col-sm-3">
              <p>旗下网站</p>
              <ul class="list-unstyled">
                <li><a href="#">计算机网络</a></li>
              </ul>
            </div>
            <div class="col-sm-3">
              <p>赞助商</p>
              <ul class="list-unstyled">
                <li><a href="#">欢迎赞助</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="./public/jquery.min.js"><\/script>')</script>
  <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="./public/ie10-viewport-bug-workaround.js"></script>
</body>
</html>
